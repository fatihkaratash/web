@{
    ViewData["Title"] = "Tarih ve Saat Seçin";
    var trainer = ViewBag.Trainer as FitMindAI.Models.Trainer;
    var service = ViewBag.Service as FitMindAI.Models.ServiceType;
    var trainerId = ViewBag.TrainerId as int?;
    var serviceTypeId = ViewBag.ServiceTypeId as int?;
    var slots = ViewBag.Slots as List<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>;
    var selectedDate = ViewBag.SelectedDate as string;
}

<div class="container mt-4">
    <h2>Tarih ve Saat Seçin</h2>
    <hr />

    <div class="alert alert-info">
        <strong>Antrenör:</strong> @trainer.FullName<br />
        <strong>Salon:</strong> @(trainer.Gym?.Name ?? "Belirtilmemiş")<br />
        <strong>Servis:</strong> @service.Name (@service.DurationInMinutes dk, @service.Price.ToString("C2"))
    </div>

    <!-- Tarih Seçimi -->
    <form asp-action="SelectDateTime" method="post">
        <input type="hidden" name="trainerId" value="@trainerId" />
        <input type="hidden" name="serviceTypeId" value="@serviceTypeId" />
        
        <div class="mb-3">
            <label class="form-label">Tarih Seçin</label>
            <input type="date" name="selectedDate" class="form-control" 
                   value="@selectedDate" 
                   min="@DateTime.Now.ToString("yyyy-MM-dd")" 
                   required />
        </div>

        <button type="submit" class="btn btn-primary mb-4">Müsait Saatleri Göster</button>
    </form>

    <!-- Saat Seçimi (Tarih seçildikten sonra görünür) -->
    @if (slots != null && slots.Any())
    {
        <form asp-action="Confirm" method="get">
            <input type="hidden" name="trainerId" value="@trainerId" />
            <input type="hidden" name="serviceTypeId" value="@serviceTypeId" />
            
            <div class="mb-3">
                <label class="form-label">Müsait Saatler</label>
                <select name="startDateTime" class="form-select" required>
                    <option value="">Saat seçin...</option>
                    @foreach (var slot in slots)
                    {
                        <option value="@slot.Value">@slot.Text</option>
                    }
                </select>
            </div>

            <div class="d-flex gap-2">
                <a asp-action="SelectService" asp-route-trainerId="@trainerId" class="btn btn-secondary">Geri</a>
                <button type="submit" class="btn btn-primary">İleri</button>
            </div>
        </form>
    }
    else if (selectedDate != null)
    {
        <div class="alert alert-warning">
            Seçtiğiniz tarih için müsait saat bulunamadı. Lütfen başka bir tarih deneyin.
        </div>
        <a asp-action="SelectService" asp-route-trainerId="@trainerId" class="btn btn-secondary">Geri</a>
    }
    else
    {
        <a asp-action="SelectService" asp-route-trainerId="@trainerId" class="btn btn-secondary">Geri</a>
    }
</div>
